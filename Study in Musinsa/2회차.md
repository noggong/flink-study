# 스트리밍 처리 기초
- ## 데이터 플로우 그래프
	- 데이터 처리 연산 사이로 데이터가 어떻게 흐르는지 기술
	- ### 방향성 그래프
		- 데이터 플로우 프로그램을 표현하는 일반적인 방법
		- 노드 (node) = 연산자 (operator) 
			- 계산을 표현
			- 기본 단위
		- 엣지 : 의존 관계를 표현
		- 방향성 그래프의 예시  ![[스크린샷 2025-02-01 오전 11.14.42.png]]
- ## 데이터 병렬화와 태스크 병렬화
	- ### 데이터 병렬화 
		- 동일 연산하는 각 태스크를 병렬로 샐행 
		- 대용량에서 부하를 여러 장비로 분산
	- ### 태스트 병렬화
		- 같거나 다른데이터의 여러 연산을 수행하는 태스트를 할당
- ## 데이터 교환 전략
	- ### 전진
		- 동일한 물리 장비의 다음 태스트크로 보낸다
		- ![[스크린샷 2025-02-01 오전 11.20.26.png]]
	- ### 브로드 캐스트
		- 모든 레코드를 모든 병렬 태스크로 보낸다.
		- ![[스크린샷 2025-02-01 오전 11.20.36.png]]
	- ### 키 기반
		- 키 기준으로 같은 태스크에 보내도록 한다.
		- ![[스크린샷 2025-02-01 오전 11.20.52.png]]
	- ### 랜덤
		- 부하를 균둥하게 분산시키고자 모든 연산자 태스크로 균등 분배한다.
		- ![[스크린샷 2025-02-01 오전 11.21.04.png]]
- ## 병렬 스트림 처리
	- ### 지연
		- 이벤트를 처리하는데 걸리는 시간
		- ==짧은 지연 보장== 은 사기감지, 시스템 알람, 네트워크 모니터링, 엄격한 서비스의 수준 협약 과 같은 곳에서 사용된다.
	- ### 처리율 
		- 시스템의 처리량을 측정하는 메트릭
		- ==처리율을 가능한 한 높게 잡고 싶다면 지연을 가능한 짧게 유지==
		- 이벤트 도착 비율에 의존 (이벤트가 없으면 처리율 낮음)
		- 배압  : 최대 처리율에 도달지 지연을 악화 → 지속 → ==버퍼링도 불가능하게 돼 데이터 유실==  되는 상황
	- 스트림을 병렬로 처리하면 같은 시간에 더 많은 이벤트를 처리 → ==처리율 ↑ 지연 ↓==
	- ###  데이터 스트림 연산
		- 데이터 스르팀 : ==무한 이벤트 순서열==
		- #### 연산자 처리 방식
			- 상태가 없는 연산자 : 마지막 처리 지점부터 재시작
			- 상태가 있는 연산자 : 새로 들어온 이벤트에 의해 상태 갱신, 미래의 이벤트는 이 상태를 이벤트 처리 로직에서 사용
		- 
	- ### 데이터 인입과 방출
		- 인입 : data source 를 가져온다
		- 방출 : 수신할 외부 시스템의 소비 형태에 맞게 데이터 형식을 내보내는 연산
	- ### Transform
		- #### 변환 연산
			- 단일 경로 연산으로, 각 이벤트를 독립적으로 처리한다.![[스크린샷 2025-02-04 오전 8.23.13.png]]
		- #### 롤링집계 연산
			- 집계 연산으로 이벤트 들어올 때마다 상태를 갱신
			- 예 ) 합계, 최솟값, 최댓값![[스크린샷 2025-02-04 오전 8.23.28.png]]
		- #### 윈도우 연산
			- 일정량의 이벤트를 모아 보관하고 있다가 처리
			- 버킷 : 일정량의 이벤트 유한 집합
			- 트리거 조건을 기반으로 평가
			- 예시 ) 매5분 교차로를 건너간 교통수단의 수
			- ##### 텀블링 윈도우
				- 고정 길이에 서로 겹치지 않는 버킷으로 이벤트 할당![[스크린샷 2025-02-04 오전 8.27.15.png]]
			- ##### 슬라이딩 윈도우
				- 서로 겹치는 고정길이의 버킷으로 이벤트 할당![[스크린샷 2025-02-04 오전 8.27.50.png]]
			- ##### 세션 윈도우
				- 세션 별로 버킷 생성
				- 세션 격차라는 값으로 정의해서 이벤트들을 세션으로 그룹화![[스크린샷 2025-02-04 오전 8.29.23.png]]
- ## 시간 시멘틱
	- ### 처리시간
		- 스트림 처리 연산자가 실ㄷ행 중인 장비의 시계에서 측정한 로컬 시간
		- 로컬 시간을 기준으로 일정 시간 동안 윈도우 연산자에 도달한 모든 이벤트는 처리시간 ==윈도우== 안으로 들어감
	- ### 이벤트 시간
		- 이벤트가 실제로 발생한 시간
		- ==이벤트 내용안에 포함된 타임스탬프==
	- ### 워터 마크
		- 이벤트가 더 지연되지 않고 도착할 것이라고 확실할 수 있는 시점을 가리키는 메트릭
		- 워터마크 T 보다 늦은 시간의 이벤트는 무시하거나, 이전 결과를 보정하는 데이터로 사용
- ## 상태와 일관성 모델
	- ### 상태 관리
		- 시스템은 상태 관리를 효율적으로 해야 하고 동시에 상태를 갱신할 때 상태를 보호 해야한다.
	- ### 상태 분할
		- 병렬로 처리할 때 처리 결과가 상태와 입력 이벤트 모두에 의존하므로 복잡해 지는데, 키로 상태를 분할할 수 있고, 각 파티션 별로 독립적으로 상태를 관리할 수 있다.
	- ### 상태 복구
		- 상태를 복구하고 장애 시에도 정확한 결과를 내보내야 한다.
	- ### 태스크 실패
		- #### 결과 보장
			- ##### 최대 한번
			- ##### 최소 한번
			- ##### 정확히 한 번
			- 닫대단 정확히 한 번

# 궁금한것 정리
[[print() vs sync()]]